(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{2917:function(e,r,t){"use strict";t.r(r),t.d(r,{__N_SSP:function(){return Me},default:function(){return Ie}});var s=t(9499),n=t(3544),a=t(9008),i=t.n(a),l=t(7294),o=t(4480),c=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter(Boolean).join(" ")},d=t(3062),u=t(5893),m=function(e){var r=(0,o.sJ)(d.I);return(0,u.jsxs)("span",{className:c("error"===r?"text-red-700 bg-red-100 dark:text-red-100 dark:bg-red-700":"","ready"===r?"text-brand-700 bg-brand-100 dark:text-brand-100 dark:bg-brand-700":"","shutdown"===r||"unknown"===r?"text-orange-700 bg-orange-100 dark:text-orange-100 dark:bg-orange-700":"","startup"===r?"text-yellow-700 bg-yellow-100 dark:text-yellow-100 dark:bg-yellow-700":"",null!=e.className?e.className:"","inline-flex items-center px-3 py-0.5 rounded-full text-xs font-semibold"),children:[(0,u.jsx)("svg",{className:c("error"===r?"text-red-400":"","ready"===r?"text-brand-400":"","shutdown"===r||"unknown"===r?"text-orange-400":"","startup"===r?"text-yellow-400":"","-ml-1 mr-1.5 h-2 w-2"),fill:"currentColor",viewBox:"0 0 8 8",children:(0,u.jsx)("circle",{cx:4,cy:4,r:3})}),"Klipper"]})},x=t(951),h=function(e){var r=(0,o.sJ)(x.Cv);return(0,u.jsxs)("span",{className:c("not-running"===r?"text-red-700 bg-red-100 dark:text-red-100 dark:bg-red-700":"","connected"===r?"text-brand-700 bg-brand-100 dark:text-brand-100 dark:bg-brand-700":"","connecting"===r?"text-yellow-700 bg-yellow-100 dark:text-yellow-100 dark:bg-yellow-700":"",null!=e.className?e.className:"","inline-flex items-center px-3 py-0.5 rounded-full text-xs font-semibold"),children:[(0,u.jsx)("svg",{className:c("not-running"===r?"text-red-400":"","connected"===r?"text-brand-400":"","connecting"===r?"text-yellow-400":"","-ml-1 mr-1.5 h-2 w-2"),fill:"currentColor",viewBox:"0 0 8 8",children:(0,u.jsx)("circle",{cx:4,cy:4,r:3})}),"Moonraker"]})},p=t(2536),f=function(e){return(0,u.jsx)("nav",{"aria-label":"Progress",children:(0,u.jsx)("ol",{role:"list",className:"overflow-hidden",children:e.steps.map((function(r,t){var s="function"===typeof r.name?r.name(e.screenProps):r.name,n="function"===typeof r.description?r.description(e.screenProps):r.description;return(0,u.jsx)("li",{className:c(t!==e.steps.length-1?"pb-10":"","relative"),children:e.currentStepIndex>t?(0,u.jsxs)(u.Fragment,{children:[t!==e.steps.length-1?(0,u.jsx)("div",{className:"-ml-px absolute mt-0.5 top-4 left-4 w-0.5 h-full bg-brand-600","aria-hidden":"true"}):null,(0,u.jsxs)("span",{className:"relative flex items-start group",children:[(0,u.jsx)("span",{className:"h-9 flex items-center",children:(0,u.jsx)("span",{className:"relative z-10 w-8 h-8 flex items-center justify-center bg-brand-600 rounded-full group-hover:bg-brand-600",children:(0,u.jsx)(p.Z,{className:"w-5 h-5 text-white","aria-hidden":"true"})})}),(0,u.jsxs)("span",{className:"ml-4 min-w-0 flex flex-col",children:[(0,u.jsx)("span",{className:"text-xs font-semibold tracking-wide uppercase",children:s}),(0,u.jsx)("span",{className:"text-sm text-gray-500",children:n})]})]})]}):e.currentStepIndex===t?(0,u.jsxs)(u.Fragment,{children:[t!==e.steps.length-1?(0,u.jsx)("div",{className:"-ml-px absolute mt-0.5 top-4 left-4 w-0.5 h-full bg-gray-300","aria-hidden":"true"}):null,(0,u.jsxs)("span",{className:"relative flex items-start group","aria-current":"step",children:[(0,u.jsx)("span",{className:"h-9 flex items-center","aria-hidden":"true",children:(0,u.jsx)("span",{className:"relative z-10 w-8 h-8 flex items-center justify-center bg-white border-2 border-brand-600 rounded-full",children:(0,u.jsx)("span",{className:"h-2.5 w-2.5 bg-brand-600 rounded-full"})})}),(0,u.jsxs)("span",{className:"ml-4 min-w-0 flex flex-col",children:[(0,u.jsx)("span",{className:"text-xs font-semibold tracking-wide uppercase text-brand-600",children:s}),(0,u.jsx)("span",{className:"text-sm text-gray-500",children:n})]})]})]}):(0,u.jsxs)(u.Fragment,{children:[t!==e.steps.length-1?(0,u.jsx)("div",{className:"-ml-px absolute mt-0.5 top-4 left-4 w-0.5 h-full bg-gray-300","aria-hidden":"true"}):null,(0,u.jsxs)("span",{className:"relative flex items-start group",children:[(0,u.jsx)("span",{className:"h-9 flex items-center","aria-hidden":"true",children:(0,u.jsx)("span",{className:"relative z-10 w-8 h-8 flex items-center justify-center bg-white border-2 border-gray-300 rounded-full group-hover:border-gray-400",children:(0,u.jsx)("span",{className:"h-2.5 w-2.5 bg-transparent rounded-full group-hover:bg-gray-300"})})}),(0,u.jsxs)("span",{className:"ml-4 min-w-0 flex flex-col",children:[(0,u.jsx)("span",{className:"text-xs font-semibold tracking-wide uppercase text-gray-500",children:s}),(0,u.jsx)("span",{className:"text-sm text-gray-500",children:n})]})]})]})},s)}))})})},b=t(8767),g=t(29),j=t(7794),y=t.n(j),v=t(6828),w=function(e){var r=(0,l.useState)(null),t=r[0],s=r[1],n=e.onSelect,a=(0,l.useCallback)((function(r){void 0===e.value&&s(r),null===n||void 0===n||n(r)}),[n,e.value]);return(0,l.useEffect)((function(){void 0!==e.value&&s(e.value)}),[e.value]),(0,u.jsxs)(v.E,{value:t,onChange:a,children:[(0,u.jsx)(v.E.Label,{className:"sr-only",children:"Selector"}),(0,u.jsx)("div",{className:"space-y-4",children:e.cards.map((function(e,r){return(0,u.jsx)(v.E.Option,{value:e,className:function(e){var r=e.checked,t=e.active;return c(r?"border-transparent":"border-gray-300",t?"ring-2 ring-brand-600":"","relative bg-white border rounded-lg shadow-sm px-6 py-4 cursor-pointer flex justify-between focus:outline-none")},children:function(r){var t=r.active,s=r.checked;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"flex items-center",children:(0,u.jsxs)("div",{children:[(0,u.jsx)(v.E.Label,{as:"p",className:"font-bold text-gray-900 text-sm",children:e.name}),(0,u.jsx)(v.E.Description,{as:"div",className:"text-gray-500 text-xs",children:(0,u.jsx)("p",{className:"sm:inline",children:e.details})})]})}),(0,u.jsx)(v.E.Description,{as:"div",className:"mt-2 flex text-sm sm:mt-0 sm:block sm:ml-4 sm:text-right",children:e.right}),(0,u.jsx)("div",{className:c(t?"border":"border-2",s?"border-brand-600":"border-transparent","absolute -inset-px rounded-lg pointer-events-none"),"aria-hidden":"true"})]})}},e.name+r)}))})]})},N=t(6010),k=function(e){return(0,u.jsxs)("svg",{className:(0,N.Z)("animate-spin h-5 w-5 text-black",e.noMargin?"":"-ml-1 mr-3",e.className),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,u.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,u.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})},S=t(256),O=function(e){return(0,u.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,u.jsxs)("div",{className:"flex",children:[(0,u.jsx)("div",{className:"flex-shrink-0",children:(0,u.jsx)(S.Z,{className:"h-5 w-5 text-red-400","aria-hidden":"true"})}),(0,u.jsxs)("div",{className:"ml-3",children:[(0,u.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,u.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,u.jsx)("p",{children:e.children})})]})]})})},P=t(912),C=t(3023),F=t(2940),E=t(6853),D=0,T=function(e){var r=(0,l.useRef)(D++),t=e.onChange,s=(0,l.useState)(!1),n=s[0],a=s[1],i=(c("h-5 w-5",(e.error,"text-red-500")),e.error?(0,u.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,u.jsx)(E.Z,{className:"h-5 w-5 text-red-500","aria-hidden":"true"})}):null),o=c(e.error?"border-red-300 text-red-900 placeholder-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 text-gray-900 placeholder-gray-300 focus:ring-brand-600 focus:border-brand-600","block w-full pr-10 focus:outline-none sm:text-sm rounded-md shadow-sm"),d=e.error?(0,u.jsx)("p",{className:"mt-2 text-sm text-red-600",id:r.current+"-error",children:e.error}):null,m=e.help?(0,u.jsx)("p",{className:"mt-2 text-sm text-gray-500",id:"email-description",children:e.help}):null,x=(0,l.useCallback)((function(e){null===t||void 0===t||t(e.currentTarget.value)}),[t]),h=(0,l.useCallback)((function(){a((function(e){return!e}))}),[]),p=null!=i?"right-6":"right-0",f="password"===e.type?(0,u.jsx)("div",{onClick:h,className:"absolute inset-y-0 ".concat(p," pr-3 flex items-center cursor-pointer"),children:n?(0,u.jsx)(C.Z,{className:"h-5 w-5 text-gray-400"}):(0,u.jsx)(F.Z,{className:"h-5 w-5 text-gray-400"})}):null;return(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:e.label}),(0,u.jsxs)("div",{className:"mt-1 relative rounded-md shadow-sm",children:[(0,u.jsx)("input",{type:n?"text":e.type,className:o,placeholder:e.placeholder,defaultValue:e.defaultValue,onChange:x,"aria-invalid":!!e.error,"aria-describedby":e.error?r.current+"-error":void 0}),i,f]}),null!==d&&void 0!==d?d:m]})},Z=t(1321),L=t(9330),M=t(1664),I=t.n(M),R=function(e){var r=c(e.className?e.className:"","gray"===e.color?"border-zinc-300 bg-gray-100 hover:bg-gray-200 text-black":"","brand"===e.color?"text-black bg-brand-500 hover:bg-brand-600 border-transparent":"",e.disabled?"opacity-60 cursor-not-allowed":"","inline-flex items-center px-4 py-2 border text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-600");return e.href?(0,u.jsx)(I(),{href:e.href,children:(0,u.jsx)("a",{className:r,onClick:e.onClick,children:e.children})}):(0,u.jsx)("button",{className:r,onClick:e.disabled?void 0:e.onClick,children:e.children})},_=function(e){var r,t,s,n=e.left.isLoading?(0,u.jsx)(k,{}):(0,u.jsx)(Z.Z,{className:"mr-3 h-5 w-5 text-black rotate-180","aria-hidden":"true"}),a=e.left.onClick?(0,u.jsx)("div",{className:"flex-1 flex justify-start",children:(0,u.jsxs)(R,{color:"gray",disabled:e.left.disabled,onClick:e.left.onClick,children:[n,null!==(r=e.left.label)&&void 0!==r?r:"Back"]})}):null,i=e.right.isLoading?(0,u.jsx)(k,{}):(0,u.jsx)(Z.Z,{className:"ml-3 h-5 w-5 text-black-400","aria-hidden":"true"}),l=e.right.onClick?(0,u.jsxs)("div",{className:"flex-1 flex justify-end space-x-4",children:[e.skip&&(0,u.jsxs)(R,{color:"gray",onClick:e.skip.onClick,disabled:e.skip.disabled,children:[null!==(t=e.skip.label)&&void 0!==t?t:"Skip",(0,u.jsx)(L.Z,{className:"ml-3 h-5 w-5 text-black","aria-hidden":"true"})]}),(0,u.jsxs)(R,{color:"brand",disabled:e.right.disabled,onClick:e.right.onClick,children:[null!==(s=e.right.label)&&void 0!==s?s:"Next",i]})]}):null;return(0,u.jsx)("div",{className:"px-8 pb-5",children:(0,u.jsxs)("nav",{className:"bg-white py-3 flex items-center  justify-between border-t border-gray-200","aria-label":"Pagination",children:[a,l]})})},z=t(1355),B=t(2546),V=t(2911),A=function(e){var r=e.onClick,t=(0,l.useState)(!0),s=t[0],n=t[1],a=(0,l.useCallback)((function(){null===r||void 0===r||r(),n(!1)}),[r]),i=e.success?(0,u.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100",children:(0,u.jsx)(V.Z,{className:"h-6 w-6 text-green-600","aria-hidden":"true"})}):null;return(0,u.jsx)(z.u.Root,{show:s,as:l.Fragment,children:(0,u.jsx)(B.V,{as:"div",className:"fixed z-10 inset-0 overflow-y-auto",onClose:a,children:(0,u.jsxs)("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,u.jsx)(z.u.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,u.jsx)(B.V.Overlay,{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),(0,u.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"\u200b"}),(0,u.jsx)(z.u.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,u.jsxs)("div",{className:"relative inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6",children:[(0,u.jsxs)("div",{children:[i,(0,u.jsxs)("div",{className:"mt-3 text-center sm:mt-5",children:[(0,u.jsx)(B.V.Title,{as:"h3",className:"text-lg leading-6 font-medium text-gray-900",children:e.title}),(0,u.jsx)("div",{className:"mt-2",children:(0,u.jsx)("p",{className:"text-sm text-gray-500",children:e.body})})]})]}),(0,u.jsx)("div",{className:"mt-5 sm:mt-6",children:(0,u.jsx)("button",{type:"button",className:"inline-flex justify-center w-full rounded-md border border-transparent shadow-sm px-4 py-2 bg-brand-600 text-base font-medium text-white hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 sm:text-sm",onClick:a,children:e.buttonLabel})})]})})]})})})},U=(0,t(6151).x3)(),Q=t(1604),H=Q.z.object({hostname:Q.z.string().min(2).regex(/^([a-zA-Z0-9]|-)+$/,"Hostname can only include a-Z, 0-9 and dashes.")}),W=Q.z.object({ssid:Q.z.string(),passphrase:Q.z.string().min(8).max(63),country:Q.z.string().optional()});function J(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,s)}return t}var K=function(e){var r,t=(0,l.useState)({}),n=t[0],a=t[1],i=(0,l.useState)(null),c=i[0],d=i[1],m=(0,l.useState)(""),h=m[0],p=m[1],f=((0,o.sJ)(x.V5),(0,l.useState)("ratos")),b=f[0],j=f[1],v=(0,l.useState)(!1),N=v[0],S=v[1],C=U.useQuery(["wifi.scan"],{refetchInterval:function(e,r){return!r.state.error&&1e3}}),F=(C.isLoading,C.isError),E=C.error,D=C.data,Z=U.useMutation(["wifi.hostname"]),L=U.useMutation(["wifi.join"]);(0,l.useEffect)((function(){a((function(e){var r=function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?J(Object(t),!0).forEach((function(r){(0,s.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):J(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},e);return null===D||void 0===D||D.forEach((function(e){r[e.address]=e})),r}))}),[D]);var M=H.safeParse({hostname:b}),I=W.safeParse({passphrase:h,ssid:null===c||void 0===c?void 0:c.ssid}),R=(0,l.useMemo)((function(){return F?[]:Object.keys(n).map((function(e){var r,t;return{name:null!==(r=n[e].ssid)&&void 0!==r?r:"Unknown Network",id:e,details:(0,u.jsxs)("div",{className:"md:grid md:grid-cols-2 gap-4",children:[(0,u.jsxs)("div",{className:"md:col-span-1",children:[(0,u.jsx)("span",{className:"font-semibold",children:"Signal Strength:"})," ",(t=n[e].signal,t>=-40?(0,u.jsx)("span",{className:"text-green-700 font-semibold",children:"Excellent"}):t>=-67?(0,u.jsx)("span",{className:"text-lime-600 font-semibold",children:"Very good"}):t>=-70?(0,u.jsx)("span",{className:"text-yellow-600 font-semibold",children:"Okay"}):t>=-80?(0,u.jsx)("span",{className:"text-orange-500 font-semibold",children:"Not good"}):t>=-100?(0,u.jsx)("span",{className:"text-red-600 font-semibold",children:"Unusable"}):void 0)]}),(0,u.jsxs)("div",{className:"md:col-span-1",children:[(0,u.jsx)("span",{className:"font-semibold",children:"Frequency:"})," ",Math.round(n[e].frequency/100)/10,"GHz"]})]}),right:(0,u.jsx)(P.Z,{className:"h-8 w-8 text-slate-500"})}}))}),[F,n]),z=(0,l.useCallback)((function(e){d(n[e.id])}),[n]),B=(0,l.useCallback)((function(){if(null==c||null==c.ssid)throw new Error("Cannot join wifi without selecting a network");L.mutate({passphrase:h,ssid:c.ssid,country:c.country})}),[h,c,L]),V=U.useMutation("reboot"),Q=(0,l.useCallback)((0,g.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.mutateAsync();case 2:window.close();case 3:case"end":return e.stop()}}),e)}))),[V]),K=(0,l.useCallback)((0,g.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.mutateAsync({hostname:b});case 2:S(!0);case 3:case"end":return e.stop()}}),e)}))),[Z,b]),q=c&&L.isSuccess&&N&&!V.isSuccess&&!V.isError?(0,u.jsx)(A,{title:"Settings saved!",body:"RatOS is now setup to connect to ".concat(c.ssid,"! Your raspberry pi will now reboot, and join your local wifi network. Click the button below to reboot the pi and close this window. You can then reconnect to your local network where http://").concat(b,".local/ should be available in a few minutes. If RatOS fails to join ").concat(c.ssid,', it will recreate the "ratos" hotspot and you\'ll have to try again.'),buttonLabel:"Got it!",onClick:Q}):V.isError?(0,u.jsx)("div",{className:"mb-4 h-48",children:(0,u.jsx)(O,{children:V.error})}):V.isLoading||V.isSuccess?(0,u.jsxs)("div",{className:"mb-4 h-48",children:[(0,u.jsx)("div",{className:"flex justify-center items-center font-bold mb-4",children:"Rebooting..."}),(0,u.jsx)("div",{className:"flex justify-center items-center mb-4",children:(0,u.jsxs)("div",{children:["Please reconnect to ",null!==(r=null===c||void 0===c?void 0:c.ssid)&&void 0!==r?r:"your local network"," and visit"," ",(0,u.jsxs)("a",{href:"http://".concat(b,".local/configure?step=1"),className:"text-brand-600",children:["http://",b,".local/configure?step=1"]})," ","in a few minutes."]})})]}):c&&L.isSuccess?(0,u.jsx)(T,{label:"Printer hostname",type:"text",defaultValue:"RatOS",error:Z.isError?Z.error.message:M.success?void 0:M.error.issues[0].message,onChange:j,help:'Only use characters from a-Z and dashes. For example, entering "RatOS" will make your printer available at http://RatOS.local/'},"hostname"):c?(0,u.jsx)(T,{label:c.security.toLocaleUpperCase()+" Password",type:"password",error:L.isError?L.error.message:I.success?void 0:I.error.issues[0].message,onChange:p},"password"):F?(0,u.jsx)("div",{className:"mb-4 h-48",children:(0,u.jsx)(O,{children:null===E||void 0===E?void 0:E.message})}):0===Object.keys(n).length?(0,u.jsx)("div",{className:"flex justify-center items-center mb-4 h-48",children:(0,u.jsx)(k,{})}):(0,u.jsx)(w,{cards:R,onSelect:z}),Y={onClick:e.nextScreen,label:"Skip"},G={onClick:e.previousScreen},X="Pick an access point to join";return c&&(Y={label:"Save Wifi Credentials",disabled:!I.success||L.isLoading,isLoading:L.isLoading,onClick:B},G={onClick:function(){return d(null)},label:"Back",disabled:L.isLoading},X="Enter password for "+c.ssid,L.isSuccess&&(Y={label:"Save and Connect",disabled:!M.success||Z.isLoading,onClick:K},G={onClick:function(){return L.reset()},label:"Back",disabled:L.isLoading},X="Enter the hostname you want to use for the printer",N&&(Y={onClick:e.nextScreen},G={},X="Proceed to next step"))),(0,u.jsxs)(l.Fragment,{children:[(0,u.jsxs)("div",{className:"p-8",children:[" ",(0,u.jsxs)("div",{className:"pb-5 mb-5 border-b border-gray-200",children:[(0,u.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Configure Wifi Setup"}),(0,u.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-gray-500",children:X})]}),q]}),(0,u.jsx)(_,{right:Y,left:G})]})},q=t(7751);function Y(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,s)}return t}function G(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Y(Object(t),!0).forEach((function(r){(0,s.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Y(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var X=function(e){var r,t,s,n,a,i,o=e.onIncrementStep,c=e.onDecrementStep,d=(0,l.useState)(null==e.step||isNaN(e.step)?0:e.step),u=d[0],m=d[1],x=e.steps[u],h=(0,l.useRef)(u);h.current=u,(0,l.useEffect)((function(){e.step&&!isNaN(e.step)&&e.step!==h.current&&m(e.step)}),[e.step]);var p=u<e.steps.length-1,f=u>0,b=(0,l.useCallback)((function(){m((function(e){return null===o||void 0===o||o(e+1),e+1}))}),[o]),g=(0,l.useCallback)((function(){m((function(e){return null===c||void 0===c||c(e-1),e-1}))}),[c]),j=G(G({},"extraScreenProps"in e?e.extraScreenProps:{}),{},{key:"step-"+u,hasNextScreen:p||null!==(r=null===(t=e.parentScreenProps)||void 0===t?void 0:t.hasNextScreen)&&void 0!==r&&r,hasPreviousScreen:f||null!==(s=null===(n=e.parentScreenProps)||void 0===n?void 0:n.hasNextScreen)&&void 0!==s&&s,nextScreen:p?b:null!==(a=e.parentScreenProps)&&void 0!==a&&a.hasNextScreen?e.parentScreenProps.nextScreen:void 0,previousScreen:f?g:null!==(i=e.parentScreenProps)&&void 0!==i&&i.hasPreviousScreen?e.parentScreenProps.previousScreen:void 0,skipSteps:e.parentScreenProps&&e.parentScreenProps.hasNextScreen?e.parentScreenProps.nextScreen:void 0}),y="function"===typeof x.name?x.name(j):x.name,v="function"===typeof x.description?x.description(j):x.description;return{screenProps:G(G({},j),{},{name:y,description:v}),currentStepIndex:u,currentStep:e.steps[u]}},$=function(e){var r;return e.isError?(0,u.jsx)("div",{className:"mb-4 h-48",children:(0,u.jsx)(O,{children:null===(r=e.error)||void 0===r?void 0:r.message})}):e.isFetching?(0,u.jsx)("div",{className:"flex items-center mb-4 absolute top-9 right-5",children:(0,u.jsx)(k,{})}):null},ee=t(4730),re=t(50),te=t(5973),se=function(e){var r;return e.isError?(0,u.jsx)("div",{className:"mb-4 h-48",children:(0,u.jsx)(O,{children:null===(r=e.error)||void 0===r?void 0:r.message})}):!e.isLoading||e.isIdle||e.isPaused?null:(0,u.jsx)("div",{className:"flex items-center mb-4 absolute top-9 right-5",children:(0,u.jsx)(k,{})})},ne=t(6692),ae=function(e){var r;return(0,u.jsx)("div",{className:"rounded-md bg-cyan-50 p-4",children:(0,u.jsxs)("div",{className:"flex",children:[(0,u.jsx)("div",{className:"flex-shrink-0",children:(0,u.jsx)(ne.Z,{className:"h-5 w-5 text-cyan-400","aria-hidden":"true"})}),(0,u.jsxs)("div",{className:"ml-3",children:[(0,u.jsx)("h3",{className:"text-sm font-medium text-cyan-800",children:null!==(r=e.title)&&void 0!==r?r:"Info"}),(0,u.jsx)("div",{className:"mt-2 text-sm text-cyan-700",children:(0,u.jsx)("p",{children:e.children})})]})]})})},ie=function(e){var r;return(0,u.jsx)("div",{className:"rounded-md bg-amber-50 p-4",children:(0,u.jsxs)("div",{className:"flex",children:[(0,u.jsx)("div",{className:"flex-shrink-0",children:(0,u.jsx)(E.Z,{className:"h-5 w-5 text-amber-400","aria-hidden":"true"})}),(0,u.jsxs)("div",{className:"ml-3",children:[(0,u.jsx)("h3",{className:"text-sm font-medium text-amber-800",children:null!==(r=e.title)&&void 0!==r?r:"Info"}),(0,u.jsx)("div",{className:"mt-2 text-sm text-amber-700",children:(0,u.jsx)("p",{children:e.children})})]})]})})},le=function(e){var r,t=U.useQuery(["mcu.dfu-detect",{boardPath:e.board.path}],{refetchInterval:1e3}),s=t.data,n=t.error,a=U.useMutation("mcu.dfu-flash",{onSuccess:e.onSuccess}),i=(0,l.useState)(!1),o=i[0],c=i[1],d=(0,l.useCallback)((0,g.Z)(y().mark((function r(){return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:c(!0),a.mutate({boardPath:e.board.path},{onSettled:function(){return c(!1)}});case 2:case"end":return r.stop()}}),r)}))),[a,e.board.path]),m=n?(0,u.jsx)(O,{children:n.message}):null,x=o?"Flashing...":s?"Flash":"Waiting for DFU...",h="boardPath="+encodeURIComponent(e.board.path),p=null===(r=e.board.dfu)||void 0===r?void 0:r.instructions.map((function(e,r){return(0,u.jsx)("li",{children:e},r)})),f=s?"DFU device detected":"DFU not detected";return(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("h3",{className:"text-xl font-medium text-gray-900",children:["Flashing ",e.board.name," via DFU"]}),m,(0,u.jsxs)("p",{className:"mt-4 text-gray-500",children:["Status: ",f]}),(0,u.jsx)(R,{color:"brand",disabled:!s||o,onClick:d,children:x}),(0,u.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"DFU Boot Instructions"}),(0,u.jsxs)("div",{className:"mt-4 prose text-base text-gray-500",children:[(0,u.jsx)("ol",{className:"list-decimal pl-4 mb-4",children:p}),(0,u.jsx)("img",{src:"/configure/api/dfu-image?"+h,alt:"DFU boot buttons and or jumper visualization"})]})]})},oe=t(3011),ce=t(4855),de=function(e){var r=(0,l.useState)(!1),t=r[0],s=r[1],n=(0,o.sJ)(x.V5),a=(0,l.useState)(!1),i=a[0],c=a[1],d=U.useMutation("mcu.compile",{onSuccess:function(){return c(!0)},onError:function(){return c(!1)}}),m=(0,b.useMutation)((function(){return n?n("machine.shutdown"):Promise.reject("Cannot reboot raspberry pi: No connection to moonraker")})),h=d.isLoading?(0,u.jsxs)("span",{children:["Compiling... ",(0,u.jsx)(k,{className:"inline ml-1",noMargin:!0})]}):(0,u.jsxs)("span",{children:["Compile firmware ",(0,u.jsx)(oe.Z,{className:"h-5 w-5 inline"})]});return(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("h3",{className:"text-xl font-medium text-gray-900",children:[e.board.manufacturer," ",e.board.name," was not detected"]}),(0,u.jsx)(R,{color:"brand",onClick:i?void 0:function(){return d.mutate({boardPath:e.board.path})},className:"w-52 justify-center",disabled:d.isLoading&&!i,href:i?"/api/download-firmware?boardPath="+encodeURIComponent(e.board.path):void 0,children:i?(0,u.jsxs)("span",{children:["Download firmware ",(0,u.jsx)(ce.Z,{className:"h-5 w-5 inline"})]}):h}),(0,u.jsxs)("div",{className:"mt-4 prose text-base text-gray-500",children:[(0,u.jsxs)("ol",{className:"list-decimal pl-4 mb-4",children:[(0,u.jsx)("li",{children:"Disconnect all wires except Power and USB, and make sure your jumpers are set correctly."}),(0,u.jsx)("li",{children:"Format the sd card for your board to FAT16 (sometimes just called FAT), or FAT32 with a clustersize of 8kb or 4kb."}),(0,u.jsx)("li",{children:"If you're reusing a card you've used for flashing before, be sure to delete ALL files on the card (or reformat it)."}),(0,u.jsx)("li",{children:"Copy the firmware binary onto the sd card for your board"}),(0,u.jsx)("li",{children:'Make sure the firmware file is called firmware.bin on the sd card (enable "display file extensions" in your file explorer). The file you downloaded will already have the correct name.'}),(0,u.jsx)("li",{children:"Safely eject the SD card through your operating system."}),(0,u.jsx)("li",{children:"Physically take out the sd card and insert it into your control board."}),(0,u.jsx)("li",{children:"Click the reset button on the board, or turn it off and back on again. NOTE: if the Raspberry Pi running RatOS is currently powered by your control board or the same power source, please shut it down safely first by using the button below. When the green light stops blinking and is turned off, you can cut the power."}),(0,u.jsx)("li",{children:'Click "Check board status" below.'})]}),(0,u.jsxs)("div",{className:"flex gap-x-4",children:[(0,u.jsx)(R,{color:"gray",onClick:function(){s(!0)},children:"Shutdown RatOS"}),(0,u.jsx)(R,{color:"brand",onClick:e.onSuccess,children:"Check board status"})]})]}),t?(0,u.jsx)(A,{title:"Shutdown RatOS?",body:"You raspberry pi will shutdown and this page will become unresponsive until it's powered back on. Do not remove power before the green light on the Rasperry Pi has stopped blinking.",buttonLabel:"Shutdown",onClick:function(){m.mutate()}}):null]})},ue=["data"],me=["data","isLoading"];function xe(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,s)}return t}function he(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?xe(Object(t),!0).forEach((function(r){(0,s.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):xe(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var pe=function(e){var r=(0,l.useState)(!1),t=r[0],s=r[1],n=(0,l.useState)(null),a=n[0],i=n[1],o=U.useQuery(["mcu.detect",{boardPath:e.selectedBoards[0].board.path}],{refetchInterval:1e3}),c=o.data,d=(0,ee.Z)(o,ue),m=U.useQuery(["mcu.board-version",{boardPath:e.selectedBoards[0].board.path}],{enabled:!!c&&!1===t,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1}),x=m.data,h=m.isLoading,p=(0,ee.Z)(m,me),f=U.useQuery(["klipper-version"],{refetchInterval:6e4}).data,b=U.useMutation("mcu.flash-via-path",{onSuccess:function(){return s(!1)}}),g=(0,l.useCallback)((function(){console.log("reflash!"),i(null),s(!0),d.remove(),p.remove()}),[]),j={onClick:e.nextScreen,label:"Next",disabled:!c||t},y={onClick:e.previousScreen},v=e.selectedBoards[0].board,w=(0,l.useCallback)((function(){i("path"),b.mutate({boardPath:v.path})}),[b,v.path]),N=null;if(h&&!p.isIdle)N=(0,u.jsxs)(l.Fragment,{children:[(0,u.jsxs)("h3",{className:"text-xl font-medium text-gray-900",children:[(0,u.jsx)(k,{className:"inline relative -top-0.5 mr-2",noMargin:!0})," ",v.name," detected, checking version..."]}),(0,u.jsx)("p",{children:"Please wait while RatOS queries your board.."})]});else if(x||c&&!t){var S,O,P="dfu"===a&&null!==(S=v.dfu)&&void 0!==S&&S.reminder?(0,u.jsx)(ae,{title:"Reminder",children:null===(O=v.dfu)||void 0===O?void 0:O.reminder}):null,C=null!=x&&null!=f&&x!==f?(0,u.jsxs)(ie,{title:"Version mismatch",children:["The board is running version ",x," but you your pi is on version ",f,". If you want to update your board click 'flash again' below."]}):null;N=(0,u.jsxs)(l.Fragment,{children:[(0,u.jsxs)("h3",{className:"text-xl font-medium text-gray-900",children:[(0,u.jsx)(re.Z,{className:"text-brand-700 h-7 w-7 inline relative -top-0.5"})," ",v.name," detected"]}),P,C,(0,u.jsxs)("p",{children:["Proceed to the next step or"," ",(0,u.jsxs)("button",{color:"gray",className:"text-brand-700 hover:text-brand-600",onClick:g,children:["flash again ",(0,u.jsx)(te.Z,{className:"h-5 w-5 inline"})]})]})]})}else if(null==a){var F=null,E=null,D=null;null!=v.dfu&&(F=(0,u.jsx)(R,{color:"gray",onClick:function(){return i("dfu")},className:"justify-center",children:"Flash manually via DFU"})),v.isToolboard||(E=(0,u.jsx)(R,{color:"gray",onClick:function(){return i("sdcard")},className:"justify-center",children:"Flash manually via SD card"})),c&&null!=v.flashScript&&(D=(0,u.jsx)(R,{color:"gray",onClick:w,className:"justify-center",children:"Flash automatically"})),N=(0,u.jsxs)(l.Fragment,{children:[(0,u.jsxs)("h3",{className:"text-xl font-medium text-gray-900",children:["How do you want to flash your ",v.name,"?"]}),(0,u.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3",children:[D,F,E]})]})}else switch(a){case"dfu":N=(0,u.jsx)(le,{board:v,onSuccess:function(){return s(!1)}});break;case"sdcard":N=(0,u.jsx)(de,{board:v,onSuccess:function(){return s(!1)}});break;case"path":N=(0,u.jsxs)("div",{children:[(0,u.jsxs)("h3",{className:"text-xl font-medium text-gray-900",children:["Flashing ",v.name,"..."]}),(0,u.jsx)("div",{className:"mt-4 prose text-base text-gray-500",children:"Please wait while RatOS flashes your board."}),(0,u.jsx)(se,he({},b))]})}return(0,u.jsxs)(l.Fragment,{children:[(0,u.jsxs)("div",{className:"p-8",children:[" ",(0,u.jsxs)("div",{className:"pb-5 mb-5 border-b border-gray-200",children:[(0,u.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:e.name}),(0,u.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-gray-500",children:e.description})]}),(0,u.jsx)("div",{className:"space-y-4",children:N})]}),(0,u.jsx)(_,{right:j,left:y})]})},fe=function(e){var r=(0,l.useMemo)((function(){return e.cards.filter((function(r){return!0===e.toolboards?r.board.isToolboard:!r.board.isToolboard}))}),[e.toolboards,e.cards]),t=(0,u.jsx)(w,{cards:r,value:e.selectedBoards[0],onSelect:e.setSelectedBoard}),s={onClick:e.nextScreen,label:"Next",disabled:!0},n={onClick:e.previousScreen},a=e.toolboards&&e.skipSteps?{onClick:e.skipSteps,label:"Skip"}:void 0;return e.selectedBoards.length>0&&(s={onClick:e.nextScreen,label:"Next"}),(0,u.jsxs)(l.Fragment,{children:[(0,u.jsxs)("div",{className:"p-8",children:[" ",(0,u.jsxs)("div",{className:"pb-5 mb-5 border-b border-gray-200",children:[(0,u.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:e.name}),(0,u.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-gray-500",children:e.description})]}),t]}),(0,u.jsx)(_,{right:s,left:n,skip:a})]})};function be(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,s)}return t}function ge(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?be(Object(t),!0).forEach((function(r){(0,s.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):be(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var je=[{id:"01",name:function(e){return e.toolboards?"Toolboard":"Control board"},description:function(e){return"Pick your ".concat(e.toolboards?"toolboard":"control board. If you also use a toolboard, you can add that later.")},href:"#",renderScreen:function(e){return(0,u.jsx)(fe,ge({},e))}},{id:"02",name:function(e){return"".concat(e.toolboards?"Toolboard":"Control board"," flashing")},description:function(e){return"Make sure your ".concat(e.toolboards?"toolboard":"control board"," is flashed and up to date")},href:"#",renderScreen:function(e){return(0,u.jsx)(pe,ge({},e))}}],ye=function(e){var r=(0,l.useState)([]),t=r[0],s=r[1],n=(0,o.sJ)(x.V5),a=U.useQuery(["mcu.boards"]),i=(0,b.useMutation)(function(){var r=(0,g.Z)(y().mark((function r(t){var s;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=n){r.next=2;break}throw new Error("Moonraker not connected");case 2:return r.next=4,n("server.database.post_item",{namespace:"RatOS",key:e.toolboards?"toolboards":"boards",value:JSON.stringify(t)});case 4:return s=r.sent,r.abrupt("return",s);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),c=(0,b.useQuery)("selectedBoard",(0,g.Z)(y().mark((function r(){var t;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=n){r.next=2;break}throw new Error("Moonraker not connected");case 2:return r.next=4,n("server.database.get_item",{namespace:"RatOS",key:e.toolboards?"toolboards":"boards"});case 4:return t=r.sent,r.abrupt("return",JSON.parse(t.value));case 6:case"end":return r.stop()}}),r)})))),d=(0,l.useCallback)((function(e){i.mutate([e.board]),s([e])}),[i]),m=(0,l.useMemo)((function(){return a.isError||null==a.data?[]:a.data.map((function(e){return{board:e,name:e.manufacturer+" "+e.name,details:(0,u.jsxs)("span",{children:[(0,u.jsx)("span",{className:"font-semibold",children:"Automatic flashing:"})," ",e.flashScript?"Yes":"No"]}),right:(0,u.jsx)(q.Z,{className:"h-8 w-8 text-slate-500"})}}))}),[a.isError,a.data]);(0,l.useEffect)((function(){var e=m.find((function(e){var r;return e.board.serialPath===(null===(r=c.data)||void 0===r?void 0:r[0].serialPath)}));s(e?[e]:[])}),[c.data,m]);var h={selectedBoards:t,cards:m,setSelectedBoard:d,toolboards:e.toolboards},p=X({steps:je,parentScreenProps:e,extraScreenProps:h}),f=p.currentStep,j=p.screenProps;return(0,u.jsxs)(u.Fragment,{children:[f.renderScreen(ge(ge({},j),h)),(0,u.jsx)($,ge({},a))]})},ve=t(1163),we=function(e){return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"p-8",children:[" ",(0,u.jsxs)("div",{className:"pb-5 mb-5 border-b border-gray-200",children:[(0,u.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:e.name}),(0,u.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-gray-500",children:e.description})]}),(0,u.jsxs)("div",{className:"space-y-4",children:["Now that your controlboard is configured, you can connect to your printer via Mainsail and start configuring and calibrating your printer.",(0,u.jsxs)("div",{className:"mt-5",children:["You can now continue to"," ",(0,u.jsx)("a",{href:"https://os.ratrig.com/docs/configuration#initial-configuration",target:"_blank",rel:"noreferrer",className:"text-brand-700 hover:text-brand-600 cursor-pointer",children:"the next step in the documentation."})]})]})]}),(0,u.jsx)(_,{left:{onClick:e.previousScreen},right:{onClick:function(){window.location.href="http://"+window.location.hostname},label:"Open Mainsail"}})]})},Ne=t(3990),ke=t(7349),Se=t(1415),Oe=function(e){var r=e.open,t=e.setOpen,s=e.isFailed?(0,u.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:(0,u.jsx)(Se.Z,{className:"h-6 w-6 text-red-600","aria-hidden":"true"})}):(0,u.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:(0,u.jsx)(V.Z,{className:"h-6 w-6 text-green-600","aria-hidden":"true"})}),n=(0,N.Z)("inline-flex w-full justify-center rounded-md border border-transparent px-4 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2 sm:text-sm",e.isLoading?"bg-brand-600 text-base font-medium text-white opacity-50 cursor-not-allowed":"bg-brand-600 text-base font-medium text-white hover:bg-brand-700");return(0,u.jsx)(z.u.Root,{show:r,as:l.Fragment,children:(0,u.jsxs)(B.V,{as:"div",className:"relative z-10",onClose:t,children:[(0,u.jsx)(z.u.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,u.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),(0,u.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,u.jsx)("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:(0,u.jsx)(z.u.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,u.jsxs)(B.V.Panel,{className:"relative transform overflow-hidden rounded-lg bg-white px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-sm md:max-w-lg lg:max-w-xl xl:max-w-3xl sm:p-6",children:[(0,u.jsxs)("div",{children:[e.isLoading?(0,u.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-slate-100",children:(0,u.jsxs)("svg",{className:(0,N.Z)("animate-spin h-6 w-6 text-gray-800"),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,u.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,u.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):s,(0,u.jsxs)("div",{className:"mt-3 text-center sm:mt-5",children:[(0,u.jsx)(B.V.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:e.title}),(0,u.jsx)("div",{className:"mt-2",children:(0,u.jsx)("div",{className:"text-sm text-gray-500",children:e.children})})]})]}),(0,u.jsx)("div",{className:"mt-5 sm:mt-6",children:(0,u.jsx)("button",{type:"button",className:n,onClick:e.isLoading?void 0:function(){return t(!1)},disabled:e.isLoading,children:e.dismissText})})]})})})})]})})};function Pe(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,s)}return t}function Ce(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Pe(Object(t),!0).forEach((function(r){(0,s.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Pe(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function Fe(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter(Boolean).join(" ")}var Ee=function(){var e=(0,l.useState)(!1),r=e[0],t=e[1],s=(0,l.useState)(!1),n=s[0],a=s[1],i=(0,l.useState)({title:"",children:null,dismissText:"OK"}),o=i[0],c=i[1],d=(0,l.useState)({title:"",children:null,dismissText:"OK"}),m=d[0],x=d[1],h=U.useMutation("klippy-extensions.symlink"),p=U.useMutation("mcu.flash-all-connected"),f=r?(0,u.jsx)(Oe,Ce(Ce({},m),{},{setOpen:t,open:r,isFailed:h.isError,isLoading:h.isLoading})):null,b=n?(0,u.jsx)(Oe,Ce(Ce({},o),{},{setOpen:a,open:n,isFailed:p.isError,isLoading:p.isLoading})):null,g=(0,l.useCallback)((function(){c({title:"Flash Firmware",children:(0,u.jsx)("p",{children:"Please wait while RatOS is flashing your connected boards..."}),dismissText:"Please wait..."}),a(!0),p.mutateAsync().then((function(e){c({title:"Flashing Complete",children:(0,u.jsx)("p",{dangerouslySetInnerHTML:{__html:e.replace(/\n/g,"<br />")}}),dismissText:"OK"})}),(function(e){c({title:"Flashing Failed",children:"string"===typeof e||e instanceof String?(0,u.jsx)("p",{dangerouslySetInnerHTML:{__html:e.replace(/\n/g,"<br />")}}):(0,u.jsx)("p",{children:"Something wen't wrong while flashing the connected boards, please try again."}),dismissText:"OK"})}))}),[p]),j=(0,l.useCallback)((function(){x({title:"Symlink Extensions",children:(0,u.jsx)("p",{children:"Please wait while RatOS is symlinking klippy extensions..."}),dismissText:"Please wait..."}),t(!0),h.mutateAsync().then((function(e){x({title:"Symlink Complete",children:(0,u.jsx)("p",{dangerouslySetInnerHTML:{__html:e.replace(/\n/g,"<br />")}}),dismissText:"OK"})}),(function(e){x({title:"Symlink Failed",children:"string"===typeof e||e instanceof String?(0,u.jsx)("p",{dangerouslySetInnerHTML:{__html:e.replace(/\n/g,"<br />")}}):(0,u.jsx)("p",{children:"Something wen't wrong while symlinking the extensions, please try again."}),dismissText:"OK"})}))}),[h]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(Ne.v,{as:"div",className:"relative inline-block text-left",children:[(0,u.jsx)("div",{children:(0,u.jsxs)(Ne.v.Button,{className:"inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2 focus:ring-offset-gray-100",children:["Actions",(0,u.jsx)(ke.Z,{className:"-mr-1 ml-2 h-5 w-5","aria-hidden":"true"})]})}),(0,u.jsx)(z.u,{as:l.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,u.jsxs)(Ne.v.Items,{className:"absolute right-0 z-10 mt-2 w-56 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:[(0,u.jsx)("div",{className:"py-1",children:(0,u.jsx)(Ne.v.Item,{children:function(e){var r=e.active;return(0,u.jsx)("span",{onClick:j,className:Fe(r?"bg-gray-100 text-gray-900":"text-gray-700","block px-4 py-2 text-sm cursor-pointer"),children:"Symlink klippy extensions"})}})}),(0,u.jsx)("div",{className:"py-1",children:(0,u.jsx)(Ne.v.Item,{children:function(e){var r=e.active;return(0,u.jsx)("span",{onClick:g,className:Fe(r?"bg-gray-100 text-gray-900":"text-gray-700","block px-4 py-2 text-sm cursor-pointer"),children:"Flash all connected MCU's"})}})})]})})]}),f,b]})};function De(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,s)}return t}function Te(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?De(Object(t),!0).forEach((function(r){(0,s.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):De(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var Ze=new b.QueryClient,Le=[{id:"00",name:"Wifi Setup",description:"Setup Wifi Connectivity",href:"#",renderScreen:function(e){return(0,u.jsx)(K,Te({},e))}},{id:"01",name:"Control board preparation",description:"Firmware flashing and connectivity",href:"#",renderScreen:function(e){return(0,u.jsx)(ye,Te({},e))}},{id:"02",name:"Toolboard Preparation",description:"Firmware flashing and connectivity",href:"#",renderScreen:function(e){return(0,u.jsx)(ye,Te(Te({},e),{},{toolboards:!0}))}},{id:"03",name:"Configure printer in Mainsail",description:"Choose your hardware and start calibrating your printer",href:"#",renderScreen:function(e){return(0,u.jsx)(we,Te({},e))}}],Me=!0,Ie=(0,n.withSuperJSONPage)((function(e){var r=(0,ve.useRouter)(),t=r.query.step?parseInt(r.query.step,10):null,s=U.useQuery(["version"]).data,n=U.useQuery(["ip-address"]).data,a=X({step:null!==t&&void 0!==t?t:void 0,onIncrementStep:function(e){r.push("/?step="+e,void 0,{shallow:!0})},onDecrementStep:function(e){r.push("/?step="+e,void 0,{shallow:!0})},steps:Le}),o=a.currentStepIndex,c=a.screenProps,d=a.currentStep;return(0,u.jsx)(b.QueryClientProvider,{client:Ze,children:(0,u.jsxs)(l.Fragment,{children:[(0,u.jsxs)(i(),{children:[(0,u.jsx)("title",{children:"RatOS Configurator"}),(0,u.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,u.jsxs)("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 md:flex md:items-center md:justify-between md:space-x-5 lg:max-w-7xl lg:px-8",children:[(0,u.jsx)("div",{className:"flex items-center space-x-5",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Printer Setup"}),(0,u.jsxs)("p",{className:"text-sm font-medium text-gray-500",children:["RatOS ",s," @ ",n]})]})}),(0,u.jsxs)("div",{className:"mt-6 md:mt-0",children:[(0,u.jsxs)("div",{className:"flex space-x-1 sm:flex-row-reverse sm:justify-end sm:space-x-reverse sm:space-y-0 sm:space-x-3 md:flex-row md:space-x-3",children:[(0,u.jsx)(m,{}),(0,u.jsx)(h,{})]}),(0,u.jsx)("div",{className:"flex justify-end mt-2",children:(0,u.jsx)(Ee,{})})]})]}),(0,u.jsxs)("div",{className:"mt-8 max-w-3xl mx-auto grid grid-cols-1 gap-6 sm:px-6 lg:max-w-7xl lg:grid-flow-col-dense lg:grid-cols-3",children:[(0,u.jsx)("div",{className:"lg:col-start-1 lg:col-span-2",children:(0,u.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden relative",children:d.renderScreen(c)})}),(0,u.jsx)("div",{className:"space-y-6 lg:col-start-3 lg:col-span-1",children:(0,u.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden p-8",children:[(0,u.jsx)("div",{className:"pb-5 mb-5 border-b border-gray-200",children:(0,u.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Setup Progress"})}),(0,u.jsx)(f,{steps:Le,screenProps:c,currentStepIndex:o})]})})]})]})})}))},8312:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(2917)}])}},function(e){e.O(0,[808,774,888,179],(function(){return r=8312,e(e.s=r);var r}));var r=e.O();_N_E=r}]);